#!/bin/bash
# æ™ºèƒ½ä½“ç¤¾åŒºæ–°é—»æœé›†è„šæœ¬
# ç”¨é€”ï¼šæœé›†moltbotåŠç±»ä¼¼AI agentç¤¾åŒºçš„æ–°é—»åŠ¨æ€

set -e

WORKSPACE="/root/.openclaw/workspace"
REPORT_DIR="$WORKSPACE/reports/agent-community-news"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
REPORT_FILE="$REPORT_DIR/news_${TIMESTAMP}.md"

# åˆ›å»ºæŠ¥å‘Šç›®å½•
mkdir -p "$REPORT_DIR"

# è®°å½•å¼€å§‹æ—¶é—´
DATE=$(date '+%Y-%m-%d %H:%M:%S')
echo "ðŸ“° å¼€å§‹æœé›†æ™ºèƒ½ä½“ç¤¾åŒºæ–°é—»..."

# åˆ›å»ºæŠ¥å‘Šå¤´
cat > "$REPORT_FILE" << EOF
# æ™ºèƒ½ä½“ç¤¾åŒºæ–°é—»æŠ¥å‘Š

**ç”Ÿæˆæ—¶é—´:** $DATE
**æŠ¥å‘Šç¼–å·:** ${TIMESTAMP}

---

EOF

# å®šä¹‰è¦å…³æ³¨çš„ç¤¾åŒº
COMMUNITIES=(
    "moltbot"
    "Cloudflare Workers AI"
    "LangChain"
    "AutoGPT"
    "OpenDevin"
    "AutoGen"
    "CrewAI"
    "BabyAGI"
    "OpenAI Agents"
)

# ä¸ºæ¯ä¸ªç¤¾åŒºæœé›†æ–°é—»
for community in "${COMMUNITIES[@]}"; do
    echo "ðŸ” æœé›† $community çš„æ–°é—»..."

    cat >> "$REPORT_FILE" << EOF

## ${community}

EOF

    # ä½¿ç”¨openclaw spawnè¿è¡Œå­agentæ¥æœé›†æ–°é—»
    # å°†ç»“æžœè¿½åŠ åˆ°æŠ¥å‘Šæ–‡ä»¶
    openclaw agent spawn \
        --task "æœé›†å¹¶æ€»ç»“å…³äºŽ ${community} çš„æœ€æ–°æ–°é—»åŠ¨æ€ï¼ˆæœ€è¿‘1-2ä¸ªæœˆï¼‰ï¼ŒåŒ…æ‹¬ï¼š
1. æ–°åŠŸèƒ½ã€æ–°çŽ©æ³•æˆ–é‡è¦æ›´æ–°
2. æ–°çš„æ’ä»¶ã€å·¥å…·æˆ–æ‰©å±•
3. å¹¿å—è®¨è®ºçš„issuesã€è¯é¢˜æˆ–äº‰è®®
4. ç¤¾åŒºé‡è¦äº‹ä»¶æˆ–é‡Œç¨‹ç¢‘

è¦æ±‚ï¼š
- ä½¿ç”¨web_searchæœç´¢ç›¸å…³æ–°é—»
- æä¾›ç®€æ´çš„ä¸­æ–‡æ€»ç»“
- æ¯ä¸ªè¦ç‚¹ç”¨ç®€æ´è¯­è¨€æè¿°
- å¦‚æžœæœ‰é‡è¦é“¾æŽ¥ï¼Œè¯·é™„ä¸Š

è¯·ç›´æŽ¥è¾“å‡ºæ€»ç»“å†…å®¹ï¼Œä¸è¦æ·»åŠ å…¶ä»–é—®å€™è¯­ã€‚" \
        --label "news-collector-${community}" \
        --cleanup delete > /tmp/news_${community}_${TIMESTAMP}.txt 2>&1 &

    sleep 3  # é¿å…åŒæ—¶å‘èµ·å¤ªå¤šè¯·æ±‚
done

# ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
echo "â³ ç­‰å¾…æ‰€æœ‰æœé›†ä»»åŠ¡å®Œæˆ..."
wait

# æ”¶é›†æ‰€æœ‰ç»“æžœ
echo "ðŸ“ æ•´ç†æœé›†ç»“æžœ..."
for community in "${COMMUNITIES[@]}"; do
    echo "ðŸ“– æ·»åŠ  ${community} çš„å†…å®¹..."

    # ä»Žä¸´æ—¶æ–‡ä»¶ä¸­æå–å†…å®¹
    if [ -f "/tmp/news_${community}_${TIMESTAMP}.txt" ]; then
        # æå–å®žé™…çš„æ–°é—»å†…å®¹ï¼ˆè¿‡æ»¤æŽ‰å·¥å…·è°ƒç”¨ç­‰ï¼‰
        grep -v "^ðŸ“¦\|^ðŸ”§\|^ðŸ“Š\|^â±ï¸" "/tmp/news_${community}_${TIMESTAMP}.txt" | \
        grep -v "^Tool call:\|^Function call:\|^Response:" | \
        tail -n +5 >> "$REPORT_FILE"
    fi

    echo "" >> "$REPORT_FILE"
    echo "---" >> "$REPORT_FILE"
    echo "" >> "$REPORT_FILE"

    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    rm -f "/tmp/news_${community}_${TIMESTAMP}.txt"
done

# æ·»åŠ æ€»ç»“éƒ¨åˆ†
cat >> "$REPORT_FILE" << EOF

## æ€»ç»“

æœ¬æŠ¥å‘Šç”± OpenClaw è‡ªåŠ¨æ–°é—»æœé›†ç³»ç»Ÿç”Ÿæˆï¼Œæ¶µç›–ä¸Šè¿°æ™ºèƒ½ä½“ç¤¾åŒºçš„æœ€æ–°åŠ¨æ€ã€‚

**æŠ¥å‘Šæ•°é‡:** ${#COMMUNITIES[@]} ä¸ªç¤¾åŒº
**ç”Ÿæˆæ–¹å¼:** è‡ªåŠ¨æœé›† + AIæ€»ç»“

---

*Generated by OpenClaw Agent News Collector*
EOF

# å¤åˆ¶åˆ°æœ€æ–°
cp "$REPORT_FILE" "$REPORT_DIR/latest.md"

# è®¡ç®—æŠ¥å‘Šå¤§å°
REPORT_SIZE=$(du -h "$REPORT_FILE" | cut -f1)

echo ""
echo "âœ… æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼"
echo "ðŸ“ æŠ¥å‘Šä½ç½®: $REPORT_FILE"
echo "ðŸ“„ æœ€æ–°æŠ¥å‘Š: $REPORT_DIR/latest.md"
echo "ðŸ“Š æŠ¥å‘Šå¤§å°: $REPORT_SIZE"
echo ""
echo "ðŸ“– æŸ¥çœ‹æŠ¥å‘Š: cat $REPORT_DIR/latest.md"
